{% extends "base.html" %}

{% block title %}תזמון אוטומטי - מערכת ניהול ועדות{% endblock %}

{% block content %}
<!-- Compact Header -->
<div class="compact-header mb-4">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1 class="page-title">
                <i class="bi bi-magic me-2"></i>אילוצים חכמים
            </h1>
            <p class="page-subtitle">המערכת מבטיחה עמידה באילוצים עסקיים ויוצרת לוח זמנים מיטבי</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('committee_types.committee_types') }}" class="btn btn-outline-primary">
                <i class="bi bi-gear me-1"></i>ניהול סוגי ועדות
            </a>
        </div>
    </div>
</div>

<!-- Compact Form Section -->
<div class="compact-form">
    <div class="row">
        <div class="col-lg-8">
            <div class="form-card">
                <h3 class="form-title mb-3">
                    <i class="bi bi-sliders me-2"></i>הגדרות התזמון
                </h3>
                <form method="POST" action="{{ url_for('auto_schedule.generate_auto_schedule') }}">
                    <div class="row g-3">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="year" class="form-label fw-semibold">שנה</label>
                                <select class="form-select form-select-lg" id="year" name="year" required>
                                    {% for y in range(2024, 2031) %}
                                        <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <!-- Hidden input to always use multiple months mode -->
                            <input type="hidden" name="month_selection_type" value="multiple">
                        </div>
                    </div>
                    
                    
                    <!-- Compact Months Selection -->
                    <div class="col-12 mb-3">
                        <label class="form-label fw-semibold mb-2">
                            <i class="bi bi-calendar-range me-2"></i>חודשים
                        </label>
                        <div class="compact-months">
                            <div class="form-check form-check-inline mb-2">
                                <input class="form-check-input" type="checkbox" id="select_all_months">
                                <label class="form-check-label fw-bold" for="select_all_months">בחר הכל</label>
                            </div>
                            <div class="months-compact-grid">
                                {% for m in range(1, 13) %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input month-checkbox" type="checkbox" 
                                           name="months" value="{{ m }}" 
                                           id="month_{{ m }}"
                                           {% if m == current_month %}checked{% endif %}>
                                    <label class="form-check-label" for="month_{{ m }}">
                                        {{ ['ינו', 'פבר', 'מרץ', 'אפר', 'מאי', 'יונ', 'יול', 'אוג', 'ספט', 'אוק', 'נוב', 'דצמ'][m-1] }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Compact Divisions Selection -->
                    <div class="col-12 mb-3">
                        <label class="form-label fw-semibold mb-2">
                            <i class="bi bi-building me-2"></i>חטיבות
                        </label>
                        <div class="compact-divisions">
                            <div class="form-check form-check-inline mb-2">
                                <input class="form-check-input" type="checkbox" id="select_all_hativot">
                                <label class="form-check-label fw-bold" for="select_all_hativot">בחר הכל</label>
                            </div>
                            <div class="divisions-compact-grid">
                                {% for hativa in hativot %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input hativa-checkbox" type="checkbox" 
                                           name="hativot_ids" value="{{ hativa.hativa_id }}" 
                                           id="hativa_{{ hativa.hativa_id }}">
                                    <label class="form-check-label" for="hativa_{{ hativa.hativa_id }}">
                                        {{ hativa.name }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compact Submit -->
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            המערכת תיצור הצעות ישיבות חכמות על בסיס האילוצים. תוכל לבדוק ולאשר לפני היצירה הסופית.
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="bi bi-magic me-2"></i>צור לוח זמנים אוטומטי
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Compact Info Sidebar -->
        <div class="col-lg-4">
            <div class="info-sidebar">
                <div class="info-box mb-3">
                    <h5><i class="bi bi-shield-check me-2"></i>אילוצים מובטחים</h5>
                    <ul class="list-unstyled small">
                        <li>• ימי עסקים בלבד</li>
                        <li>• ועדה אחת ביום</li>
                        <li>• איזון שבועי</li>
                        <li>• ימים קבועים</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h5><i class="bi bi-lightning-charge me-2"></i>יתרונות</h5>
                    <ul class="list-unstyled small">
                        <li>• חיסכון בזמן</li>
                        <li>• תזמון מיטבי</li>
                        <li>• התאמה לחטיבות</li>
                        <li>• עמידה באילוצים</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Handle select all months checkbox
    const selectAllMonthsCheckbox = document.getElementById('select_all_months');
    const monthCheckboxes = document.querySelectorAll('.month-checkbox');
    
    if (selectAllMonthsCheckbox && monthCheckboxes.length > 0) {
        selectAllMonthsCheckbox.addEventListener('change', function() {
            monthCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllMonthsCheckbox.checked;
            });
        });
        
        monthCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const allChecked = Array.from(monthCheckboxes).every(cb => cb.checked);
                const noneChecked = Array.from(monthCheckboxes).every(cb => !cb.checked);
                
                selectAllMonthsCheckbox.checked = allChecked;
                selectAllMonthsCheckbox.indeterminate = !allChecked && !noneChecked;
            });
        });
    }
    
    // Handle select all hativot checkbox
    const selectAllCheckbox = document.getElementById('select_all_hativot');
    const hativaCheckboxes = document.querySelectorAll('.hativa-checkbox');
    
    if (selectAllCheckbox && hativaCheckboxes.length > 0) {
        selectAllCheckbox.addEventListener('change', function() {
            hativaCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });
        
        hativaCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const allChecked = Array.from(hativaCheckboxes).every(cb => cb.checked);
                const noneChecked = Array.from(hativaCheckboxes).every(cb => !cb.checked);
                
                selectAllCheckbox.checked = allChecked;
                selectAllCheckbox.indeterminate = !allChecked && !noneChecked;
            });
        });
    }
    
    // Form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const selectedMonths = document.querySelectorAll('.month-checkbox:checked');
            if (selectedMonths.length === 0) {
                e.preventDefault();
                alert('אנא בחר לפחות חודש אחד');
                return false;
            }
            
            const selectedHativot = document.querySelectorAll('.hativa-checkbox:checked');
            if (selectedHativot.length === 0) {
                e.preventDefault();
                alert('אנא בחר לפחות חטיבה אחת');
                return false;
            }
        });
    }
});
</script>

<style>
/* Compact Header */
.compact-header {
    padding: 2rem 0 1rem;
    border-bottom: 1px solid #e9ecef;
}

.page-title {
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    color: #6c757d;
    margin: 0;
}

/* Compact Form */
.compact-form {
    padding: 2rem 0;
}

.form-card {
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.form-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2c3e50;
}

/* Compact Selections */
.compact-months, .compact-divisions {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
}

.months-compact-grid, .divisions-compact-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.form-check-inline {
    margin-right: 1rem;
    margin-bottom: 0.5rem;
}

.form-check-label {
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.form-check-input:checked + .form-check-label {
    background-color: #007bff;
    color: white;
}

/* Info Sidebar */
.info-sidebar {
    position: sticky;
    top: 2rem;
}

.info-box {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 1.5rem;
}

.info-box h5 {
    font-size: 1rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 1rem;
}

.info-box ul li {
    color: #6c757d;
    margin-bottom: 0.25rem;
}

/* Responsive */
@media (max-width: 768px) {
    .compact-header {
        text-align: center;
    }
    
    .page-title {
        font-size: 1.5rem;
    }
    
    .months-compact-grid, .divisions-compact-grid {
        justify-content: center;
    }
    
    .info-sidebar {
        margin-top: 2rem;
        position: static;
    }
}
</style>
{% endblock %}
