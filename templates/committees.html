{% extends "base.html" %}

{% block title %}ישיבות וועדות - איזון עומסים{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-people me-2"></i>ישיבות וועדות</h2>
        <p class="text-muted">הצגת כל הישיבות המתוכננות במערכת</p>
    </div>
</div>

<!-- Add New Meeting Button -->
<div class="row mb-4">
    <div class="col-12">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMeetingModal">
            <i class="bi bi-plus-circle me-2"></i>צור ישיבת ועדה חדשה
        </button>
    </div>
</div>

<!-- Committee Types Section -->
<div class="row mb-4">
    <div class="col-12">
        <h4><i class="bi bi-gear me-2"></i>סוגי ועדות</h4>
        <p class="text-muted">הגדרות כלליות של סוגי ועדות במערכת</p>
    </div>
</div>

<div class="row">
    {% for committee_type in committee_types %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 border-start border-info border-4">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-gear me-2"></i>{{ committee_type.name }}
                </h5>
                
                <div class="mb-3">
                    <h6 class="text-muted">פרטי תזמון:</h6>
                    <p class="mb-1">
                        <i class="bi bi-calendar me-1"></i>
                        <strong>יום:</strong> {{ committee_type.scheduled_day_name }}
                    </p>
                    <p class="mb-1">
                        <i class="bi bi-clock me-1"></i>
                        <strong>תדירות:</strong> 
                        {% if committee_type.frequency == 'monthly' %}
                            חודשי
                            {% if committee_type.week_of_month %}
                                (שבוע {{ committee_type.week_of_month }})
                            {% endif %}
                        {% else %}
                            שבועי
                        {% endif %}
                    </p>
                </div>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('auto_schedule') }}" 
                       class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-calendar-plus me-1"></i>תזמון אוטומטי
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Scheduled Meetings Section -->
<div class="row mb-4">
    <div class="col-12">
        <h4><i class="bi bi-calendar-event me-2"></i>ישיבות מתוכננות</h4>
        <p class="text-muted">ישיבות ספציפיות שנוצרו במערכת</p>
    </div>
</div>

{% if committees %}
<div class="row">
    {% for committee in committees %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 border-start border-success border-4">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-calendar-event me-2"></i>{{ committee.committee_name }}
                </h5>
                
                <div class="mb-3">
                    <p class="mb-1">
                        <i class="bi bi-building me-1"></i>
                        <strong>חטיבה:</strong> {{ committee.hativa_name }}
                    </p>
                    <p class="mb-1">
                        <i class="bi bi-calendar me-1"></i>
                        <strong>תאריך:</strong> {{ committee.vaada_date }}
                    </p>
                    <p class="mb-1">
                        <i class="bi bi-info-circle me-1"></i>
                        <strong>סטטוס:</strong> 
                        <span class="badge bg-{{ 'success' if committee.status == 'completed' else 'warning' if committee.status == 'scheduled' else 'primary' if committee.status == 'planned' else 'danger' }}">
                            {% if committee.status == 'planned' %}מתוכנן
                            {% elif committee.status == 'scheduled' %}מתוזמן
                            {% elif committee.status == 'completed' %}הושלם
                            {% elif committee.status == 'cancelled' %}בוטל
                            {% else %}{{ committee.status }}{% endif %}
                        </span>
                    </p>
                    {% if committee.notes %}
                    <p class="mb-1">
                        <i class="bi bi-sticky me-1"></i>
                        <strong>הערות:</strong> {{ committee.notes }}
                    </p>
                    {% endif %}
                </div>
                
                <div class="d-grid gap-2">
                    <a href="{{ url_for('events') }}?vaadot_id={{ committee.vaadot_id }}" 
                       class="btn btn-outline-success btn-sm">
                        <i class="bi bi-calendar-event me-1"></i>צפה באירועים
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            אין ישיבות מתוכננות כרגע. השתמש בכפתור "צור ישיבת ועדה חדשה" ליצירת ישיבה ראשונה.
        </div>
    </div>
</div>
{% endif %}

<!-- Add Meeting Modal -->
<div class="modal fade" id="addMeetingModal" tabindex="-1" aria-labelledby="addMeetingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMeetingModalLabel">צור ישיבת ועדה חדשה</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_committee_meeting') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="committee_type_id" class="form-label">סוג ועדה</label>
                        <select class="form-select" name="committee_type_id" required>
                            <option value="">בחר סוג ועדה</option>
                            {% for committee_type in committee_types %}
                                <option value="{{ committee_type.committee_type_id }}">{{ committee_type.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="hativa_id" class="form-label">חטיבה</label>
                        <select class="form-select" name="hativa_id" required>
                            <option value="">בחר חטיבה</option>
                            {% for hativa in hativot %}
                                <option value="{{ hativa.hativa_id }}">{{ hativa.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="vaada_date" class="form-label">תאריך ישיבה</label>
                        <input type="date" class="form-control" name="vaada_date" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="status" class="form-label">סטטוס</label>
                        <select class="form-select" name="status">
                            <option value="planned">מתוכנן</option>
                            <option value="scheduled">מתוזמן</option>
                            <option value="completed">הושלם</option>
                            <option value="cancelled">בוטל</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">הערות (אופציונלי)</label>
                        <textarea class="form-control" name="notes" rows="3" placeholder="הערות נוספות לישיבה"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ביטול</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>צור ישיבה
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Committee Rules Info -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-info-circle me-2"></i>כללי תזמון וועדות
                </h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success me-2"></i>פעילות בימי עסקים בלבד</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>ללא שבתות וחגים</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>ועדה אחת בלבד ביום</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li><i class="bi bi-check-circle text-success me-2"></i>מקסימום 3 וועדות בשבוע רגיל</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>מקסימום 4 וועדות בשבוע השלישי</li>
                            <li><i class="bi bi-check-circle text-success me-2"></i>גמישות להוספת ימי שבתון</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
